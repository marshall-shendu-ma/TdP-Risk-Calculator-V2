<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Categorization of TdP Risk Dependent on Compound Electrophysiological Response Predictors</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
  <script src="script_v232.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js" defer></script>
</head>
<body>
  <div class="app">
    <header style="background-color: rgb(40,124,188); color: white; padding: 20px; margin-bottom: 20px;">
      <h1 style="margin: 0; text-transform: none;">
        Categorization of TdP Risk Dependent on Compound Electrophysiological Response Predictors
      </h1>
    </header>
    <section class="introduction">
      <h2>TdP Risk Categorization Calculator Program</h2>
      <p><strong>Instructions</strong></p>
      <ol>
        <li>Read the <a href="cou.html#coU" target="_blank">Context of Use</a>.</li>
        <li>Use “Cmax Extrapolation” (click triangle).</li>
        <li>Or enter values in “Predictor Inputs.”</li>
        <li>View “Program Outputs.”</li>
      </ol>
    </section>

    <!-- Predictor Inputs Section -->
    <section class="predictors">
      <h2>Predictor Inputs</h2>
      <div style="display:flex; gap:20px; margin-bottom:10px;">
        <div>
          <label for="predictor1"><strong>Predictor 1</strong></label>
          <p>Arrhythmia: 0=no,1=type A,2=other.</p>
          <select id="predictor1">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
          </select>
        </div>
        <div>
          <label for="predictor4"><strong>Predictor 4 (ms)</strong></label>
          <input type="number" id="predictor4" step="any" placeholder="e.g. 25">
        </div>
        <div>
          <label for="predictor7"><strong>Predictor 7 (ms)</strong></label>
          <input type="number" id="predictor7" step="any" placeholder="e.g. 15">
        </div>
      </div>
      <button id="predictorCalcBtn">Calculate</button>
    </section>

    <!-- Collapsible Cmax Extrapolation Section -->
    <section class="inputs collapsible">
      <h2 id="cmaxSectionHeader" style="cursor:pointer;">▾ Cmax Extrapolation</h2>
      <div id="cmaxSectionContent">
        <form id="riskForm">
          <div style="display:flex; align-items:center; gap:10px;">
            <label for="cmax" id="cmaxLabel">Cmax (µM)</label>
            <input type="number" id="cmax" step="any" placeholder="e.g. 150.5" required>
            <button type="button" id="switchCmaxUnit">Switch Unit</button>
          </div>
          <div>
            <label for="arrhythmia">Arrhythmia Type</label>
            <select id="arrhythmia">
              <option value="0">None</option>
              <option value="1">Type A</option>
              <option value="2">Other</option>
            </select>
          </div>
          <div>
            <label for="celltype">Cell Type (numeric)</label>
            <input type="number" id="celltype" step="any" value="0">
          </div>
          <div>
            <label for="assay">Assay Time</label>
            <select id="assay">
              <option value="30">30 min</option>
              <option value="24">24 hr</option>
            </select>
          </div>
          <div>
            <label>Concentration – FPDc Pairs</label>
            <table>
              <thead><tr><th>Conc</th><th>ΔΔFPDc ms</th><th></th></tr></thead>
              <tbody id="dataBody">
                <tr><td><input type="number" name="concentration[]" step="any" required></td><td><input type="number" name="fpdc[]" step="any" required></td><td><button type="button" onclick="removeRow(this)">−</button></td></tr>
                <tr><td><input type="number" name="concentration[]" step="any" required></td><td><input type="number" name="fpdc[]" step="any" required></td><td><button type="button" onclick="removeRow(this)">−</button></td></tr>
                <tr><td><input type="number" name="concentration[]" step="any" required></td><td><input type="number" name="fpdc[]" step="any" required></td><td><button type="button" onclick="removeRow(this)">−</button></td></tr>
                <tr><td><input type="number" name="concentration[]" step="any" required></td><td><input type="number" name="fpdc[]" step="any" required></td><td><button type="button" onclick="removeRow(this)">−</button></td></tr>
              </tbody>
            </table>
            <button type="button" onclick="addRow()">Add row</button>
          </div>
          <button type="submit">Calculate</button>
        </form>
      </div>
    </section>

    <section class="description">
      <h2>Ideal Waveform Parameter Description</h2>
      <img src="Figure1_SampleWaveform.jpg" alt="Waveform" style="height:400px; max-width:100%;">
    </section>

    <section class="charts">
      <h2>Program Outputs</h2>
      <div class="model-panel">
        <div style="display:flex; align-items:center; gap:10px;">
          <h3 id="modelTitle">Model 1 TdP Risk</h3>
          <button id="toggleModelBtn">Switch Model</button>
        </div>
        <p id="modelSubtitle"></p>
        <div id="modelResults"></div>
        <canvas id="modelChart"></canvas>
      </div>
      <div>
        <h3>Hill Fit Curve</h3>
        <canvas id="hillPlot"></canvas>
      </div>
      <div>
        <h3>Predicted QT Prolongation</h3>
        <p id="estimatedQTc"></p>
      </div>
    </section>
  </div>
</body>
</html>